#!/bin/bash
# Log of an app

######################
# Standard Library and conf
######################
# The log and error handling
# We still need to use the set command
# because shellcheck does not see them and want use to add
# exit check everywhere
set -Eeuo pipefail
# echo and error_handling should be in your bashrc.d directory


######################
# Main
######################

# Check if the app name is provided
if [ -z "$1" ]; then
    echo "Usage: $0 <app name>"
    exit 1
fi

APP_NAME=$1

echo Getting Pod Name and Namespace for app "$APP_NAME"
read -r POD_NAME POD_NAMESPACE <<< "$(kube::get_resource_by_app_name "$APP_NAME" pod)"

if [ -z "$POD_NAME" ]; then
    echo "Error: Pod not found with label $APP_LABEL"
    exit 1
fi

# https://kubernetes.io/docs/reference/kubectl/generated/kubectl_logs/
echo "Getting logs for pods $POD_NAMESPACE/$POD_NAME"
kubectl logs -f -l "$APP_LABEL" -n "$POD_NAMESPACE" --all-containers=true