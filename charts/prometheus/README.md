

[//]: # (README.md generated by gotmpl. DO NOT EDIT.)

![Type: application](https://img.shields.io/badge/Type-application-informational?style=flat-square) ![Version: 0.0.1](https://img.shields.io/badge/Version-0.0.1-informational?style=flat-square) ![AppVersion: v0.79.2](https://img.shields.io/badge/AppVersion-v0.79.2-informational?style=flat-square)

# Kubee Prometheus Chart

This [jsonnet kubee chart](https://github.com/EraldyHq/kubee/blob/main/docs/site/jsonnet-chart.md) installs and configures:
* the [prometheus operator](https://prometheus-operator.dev/)
* and a [prometheus server](https://prometheus.io/)

## Features

### Add the following Mixin (Alerts and Dashboard)

* the [Prometheus Alert and dashboards](https://monitoring.mixins.dev/prometheus/#dashboards)
* the [Prometheus Operator Alerts](https://monitoring.mixins.dev/prometheus-operator/)
* the [General Alerting rules](https://runbooks.prometheus-operator.dev/runbooks/general/) (`AlertDown`, ...)

### Kubee Charts Features

  These [kubee charts](https://github.com/EraldyHq/kubee/blob/main/docs/site/kubee-helmet-chart.md) add their features when `enabled`.

* [alertmanager](https://github.com/EraldyHq/kubee/blob/main/charts/alertmanager/README.md) creates a connection to alertmanager
* [cert-manager](https://github.com/EraldyHq/kubee/blob/main/charts/cert-manager/README.md) adds [server certificates](https://cert-manager.io/docs/usage/certificate/) to the servers
* [external-secrets](https://github.com/EraldyHq/kubee/blob/main/charts/external-secrets/README.md) defines secret as [external secrets](https://external-secrets.io/latest/introduction/getting-started/#create-your-first-externalsecret) for GitOps integration (if chosen)
* [grafana](https://github.com/EraldyHq/kubee/blob/main/charts/grafana/README.md) creates [dashboards](https://grafana.com/grafana/dashboards/)
* [traefik](https://github.com/EraldyHq/kubee/blob/main/charts/traefik/README.md) creates an [ingress](https://kubernetes.io/docs/concepts/services-networking/ingress/) if hostnames are defined

## Install

```bash
kubee --cluster cluster-name helmet play prometheus
```

## Values

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| enabled | bool | `false` | Boolean to indicate that this chart is or will be installed in the cluster |
| grafana_cloud | object | `{"enabled":false,"password":"","relabel_keep_regex":"","username":""}` | Grafana cloud remote write prometheus integration |
| hostname | string | `""` | The public hostname. If not empty, an ingress is added |
| max_block_duration | string | `"30m"` | The duration that Prometheus keeps the data in memory. The default is 2h. If the value is 2h, no arguments is applied. It's the prometheus tsdb server argument --storage.tsdb.max-block-duration=2h) Note that the default value is * 1h for the prometheus query ui * 1h for the grafana explore panel (ie last hour) * 15m for Kubernetes dashboard * 24h for Headlamp We chose 30m to be below the target of 400Mi memory size with kubernetes monitoring installed |
| namespace | string | `"monitoring"` | The installation namespace. used by clients such as the Grafana Chart to create the data source URI |
| new_relic | object | `{"bearer":"","enabled":false,"relabel_keep_regex":""}` | New relic remote write prometheus integration |
| operator.resources.memory | string | `"50Mi"` | Prometheus Operator max memory |
| resources | object | `{"memory":"400Mi"}` | Prometheus Server Memory Limit |
| retention | string | `"30m"` | Retention. How long to retain data (it's the prometheus server argument storage.tsdb.retention.time=24h). Data in memory is 2 hour old, by setting retention to 2h, we don't allow to query data over 2 hours and to load data in memory The default is 24h. Why 30m? Equal to `max_block_duration` so that we are sure that we will not increase memory of the prometheus pod You can see the value in Prometheus Gui under `Status > Runtime and Build Information` |
| scrape_interval | string | `"1m"` | The default scrape interval for target It does influence memory as Prometheus keeps by default 2 hours of scraping in memory (max_block_duration) Default was 30s. |
| secret.kind | string | `"Secret"` | Kind of secret created Values supported are `Secret` or `ExternalSecret` |
| version | string | `"3.1.0"` | The [prometheus version](https://github.com/prometheus/prometheus/releases) |

## Contrib / Dev

See [contrib](contrib/contrib.md)

