
[//]: # (README.md generated by gotmpl. DO NOT EDIT.)

![Type: application](https://img.shields.io/badge/Type-application-informational?style=flat-square) ![Version: 0.0.1](https://img.shields.io/badge/Version-0.0.1-informational?style=flat-square) ![AppVersion: 0.22.1](https://img.shields.io/badge/AppVersion-0.22.1-informational?style=flat-square)

# The dex kubee chart

`Dex` is an authentication application that supports:
* a local password store
* and connectors to other open identity provider

## Features

By default,
* the admin user is created with its email as login.
* [oauth2-proxy](../oauth2-proxy/README.md) is added as client if enabled
* `kubectl` is added as client if its secret value is not empty

## Cluster Values Example

In your [cluster](../../../docs/site/cluster-creation.md) values file, you need to fill at minimum this values:
```yaml
dex:
  enabled: true
  hostname: 'dex.example.com'
  clients:
    # for traefik forward auth
    oauth2_proxy:
      secret: '${DEX_OAUTH_CLI_SECRET}'
    # for kubectl
    kubectl:
      secret: '${DEX_KUBECTL_CLI_SECRET}'
```

In the cluster `.envrc` file, set the env `DEX_OAUTH_CLI_SECRET` and `DEX_KUBECTL_CLI_SECRET` with your favorite identity store.

Example with `pass`
```bash
export DEX_FORWARD_AUTH_CLI_SECRET
DEX_FORWARD_AUTH_CLI_SECRET=$(pass "cluster_name/dex/forward-auth-cli-secret")
```

## Values

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| clients.kubectl.client_id | string | `"kubectl"` | The kubectl client id |
| clients.kubectl.secret | string | `""` | The oidc client secret (used to exchange the code between kubectl and dex) Example: `openssl rand -base64 32` |
| clients.kubernetes.client_id | string | `"kubernetes"` | The Kubernetes client id (ie token audience, fix value) |
| clients.kubernetes.trusted_peers | list | `[]` | List of trusted client id All clients that needs kubernetes access should be in that list. |
| clients.oauth2_proxy.client_id | string | `"oauth2-proxy"` | The oauth2-proxy client id. If changed, all kubee charts that depends on it should be deployed again (traefik,...) |
| clients.oauth2_proxy.secret | string | `""` | The oidc client secret (It is used to exchange the code between oauth2-proxy and dex). Example: `openssl rand -base64 32` |
| clients.others | list | `[]` | Other oidc clients definition to add your own clients. See the [doc](https://dexidp.io/docs/guides/using-dex/#configuring-your-app) |
| connectors | list | `[]` | Additional [auth connectors](https://dexidp.io/docs/connectors) |
| enabled | bool | `false` | Boolean to indicate that this chart is or will be installed in the cluster |
| expiration.access_token_lifetime | int | `10` | The access token lifetime (in minutes) 24h is the [default](https://github.com/dexidp/dex/blob/65814bbd7746611a359408bb355fb4e12d6e2c14/config.yaml.dist#L89), 10m is the [recommended doc setting](https://dexidp.io/docs/configuration/tokens/#expiration-and-rotation-settings), 1m is the [recommended setting of Oauth proxy](https://oauth2-proxy.github.io/oauth2-proxy/configuration/session_storage). You can see the real value with the exp field of the JWS token It must be an integer. Why? because the refresh process needs to be executed before, we need to apply some math. |
| expiration.refresh_token_lifetime | string | `"168h"` | The refresh token lifetime, it forces users to reauthenticate 3960h (165 days) is the [dex default](https://github.com/dexidp/dex/blob/65814bbd7746611a359408bb355fb4e12d6e2c14/config.yaml.dist#L89), 168h (7 days) is the [default cookie_expire value](https://oauth2-proxy.github.io/oauth2-proxy/configuration/overview?_highlight=cookie_expire#cookie-options) You can see the real value in the cookie lifetime of oauth |
| hostname | string | `""` | The public hostname (Required as you need a callback) |
| namespace | string | `"auth"` | The installation namespace |
| dex | object | | [Chart Dex values](https://github.com/dexidp/helm-charts/blob/dex-0.22.1/charts/dex/values.yaml) |

## Contrib / Dec

Dev and contrib documentation can be found [here](contrib/contrib.md)

