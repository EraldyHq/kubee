

[//]: # (README.md generated by gotmpl. DO NOT EDIT.)

![Type: application](https://img.shields.io/badge/Type-application-informational?style=flat-square) ![Version: 0.0.0](https://img.shields.io/badge/Version-0.0.0-informational?style=flat-square) ![AppVersion: 0.15.1](https://img.shields.io/badge/AppVersion-0.15.1-informational?style=flat-square)

# Kubee External Dns Chart

This kubee chart will install [external-dns](https://github.com/kubernetes-sigs/external-dns)

`External DNS` can update your domain/public DNS based on:
* [metadata annotations](https://kubernetes-sigs.github.io/external-dns/latest/docs/annotations/annotations/) on Ingress, Service, ...
* or [DNS CRD definition](https://kubernetes-sigs.github.io/external-dns/latest/docs/contributing/crd-source/)

## Features

### Auto Sources Creation

These sources are automatically enabled.
* [Ingress](https://kubernetes-sigs.github.io/external-dns/latest/docs/sources/ingress/) - `hostname` is retrieved from `spec.rules.host` metadata
* [Service](https://kubernetes-sigs.github.io/external-dns/latest/docs/sources/service/) - for service without Ingress (ie LoadBalancer)
* [TraefikIngress](https://kubernetes-sigs.github.io/external-dns/latest/docs/sources/traefik-proxy/) if [Traefik](https://github.com/EraldyHq/kubee/blob/main/charts/Traefik/README.md) is enabled
* [DNS CRD](https://kubernetes-sigs.github.io/external-dns/latest/docs/contributing/crd-source/). Example:
  * [Txt Record](https://kubernetes-sigs.github.io/external-dns/latest/docs/sources/txt-record/)
  * [Mx Record](https://kubernetes-sigs.github.io/external-dns/latest/docs/sources/mx-record/)

 
### Monitoring

Prometheus is automatically configured if enabled.
You can monitor [Rate Limit Metrics](https://kubernetes-sigs.github.io/external-dns/latest/docs/rate-limits/#monitoring)

### Support In-tree and WebHook DNS

This chart supports all provider type:
+ [in-tree DNS provider](https://kubernetes-sigs.github.io/external-dns/latest/#the-latest-release)
+ or [webhook DNS provider](https://kubernetes-sigs.github.io/external-dns/latest/#new-providers)

### Kubee Charts Features

  These [kubee charts](https://github.com/EraldyHq/kubee/blob/main/docs/site/kubee-helmet-chart.md) add their features when `enabled`.

* [cert-manager](https://github.com/EraldyHq/kubee/blob/main/charts/cert-manager/README.md) adds [server certificates](https://cert-manager.io/docs/usage/certificate/) to the servers
* [prometheus](https://github.com/EraldyHq/kubee/blob/main/charts/prometheus/README.md) creates [metrics scraping jobs](https://prometheus.io/docs/concepts/jobs_instances/) and [alert rules](https://prometheus.io/docs/prometheus/latest/configuration/alerting_rules/)
* [traefik](https://github.com/EraldyHq/kubee/blob/main/charts/traefik/README.md) creates an [ingress](https://kubernetes.io/docs/concepts/services-networking/ingress/) if hostnames are defined or add authorizations.

## Installation

### Configuration

Example of in-tree provider following the [cloudflare tutorial configuration](https://kubernetes-sigs.github.io/external-dns/latest/docs/tutorials/cloudflare/) :
* Get your [api token](https://github.com/EraldyHq/kubee/blob/main/docs/site/cloudflare.md)
 (`Api Key` is deprecated)
* Set your configuration in the [cluster value files](https://github.com/EraldyHq/kubee/blob/main/docs/site/cluster-values.md)

```yaml
external_dns:
  enabled: true
  provider:
    type: "in-tree" # default
    name: "cloudflare"
    env:
      # specific cloudflare envs
      - name: 'CF_API_TOKEN'
        value: '${CF_API_TOKEN}'
    args:
      # specific cloudflare args
      - '--cloudflare-dns-records-per-page=100'
      - '--cloudflare-region-key=global'
      - '--no-cloudflare-proxied'
    in_tree:
        domain_filter:
          - example.tld
```

Example of webhook provider configuration following the [Hetzner Webhook documentation](https://github.com/mconfalonieri/external-dns-hetzner-webhook):
Set this configuration in the [cluster value files](https://github.com/EraldyHq/kubee/blob/main/docs/site/cluster-values.md)

```yaml
external_dns:
  enabled: true
  provider:
    type: "webhook"
    name: "hetzner"
    image: "ghcr.io/mconfalonieri/external-dns-hetzner-webhook:v0.7.0"
    env:
      - name: 'HETZNER_API_KEY'
        value: '${HETZNER_API_KEY}'
    args:
      - '--txt-prefix=reg-%{record_type}-'
    endpoints:
      health:
        path: /health # The `healthz` value is the default but Hetzner Webhook does not follow the [specification](https://kubernetes-sigs.github.io/external-dns/latest/docs/tutorials/webhook-provider/#exposed-endpoints)
```

### Play

```bash
kubee helmet --cluster cluster-name play external-dns
```

## Values

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| enabled | bool | `false` | Boolean to indicate that this chart is or will be installed in the cluster |
| namespace | string | `"external-dns"` | The installation namespace |
| provider.args | list | `[]` | An array of args to be added to the external dns server Providers are driven by some args. Refer to their documentation to discover them. |
| provider.env | list | `[]` | An array of name, value env stored in secrets and passed as env. Providers secret are driven by env. Refer to their documentation to discover them. |
| provider.image | string | `""` | The webhook provider image. Required if the provider is `webhook`. `in-tree` uses the `external-dns` image as webhook provider. Example: `ghcr.io/mconfalonieri/external-dns-hetzner-webhook:v0.7.0` |
| provider.in_tree.domain_filter | list | `[]` | Domain filter. Limit to only domains; change to match the zone Create DNS records for host names that match E.g. `example.org` will allow the zone `example.org` and all subdomains (ie `xx.example.org`) `a.example.com` will allow for zone `example.com` `.example.com` will not attempt to match parent zones. |
| provider.in_tree.exclude_domains | list | `[]` | Exclude a domain or subdomain Example: `ignore.this.example.com` |
| provider.in_tree.regex_domain_filter | string | `""` | Limits possible domains and target zone with a regex. It overrides domain filters and can be specified only once. Example: `(example\\.org|company\\.com)$` or `example*` |
| provider.name | string | `""` | The name of the provider (Required for an in-tree provider) |
| provider.type | string | `"in-tree"` | Provider. `in-tree` or `webhook` |
| server.cache_time | string | `"4h"` | The local DNS cache to avoid [rate limiting](https://kubernetes-sigs.github.io/external-dns/latest/docs/rate-limits/) If a DNS entry is deleted/modified manually, the recovery will need to wait this interval for resynchronization. Or you need to restart the pod. |
| server.interval | string | `"1m"` | Interval for DNS sync. |
| server.policy | string | `"upsert-only"` | Policy Synchronization. `upsert-only`: Prevent deleting any records. `sync`: if you want DNS entries to get deleted as well |
| version | string | `"0.15.1"` | [External DNS version](https://github.com/kubernetes-sigs/external-dns/releases) |

There is more parameters in the [values file](values.yaml)

## Contrib / Dec

Dev and contrib documentation can be found [here](contrib/contrib.md)

